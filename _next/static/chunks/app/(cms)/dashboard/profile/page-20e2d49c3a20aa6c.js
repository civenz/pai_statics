(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1269],{93563:function(e,t,a){Promise.resolve().then(a.bind(a,21978))},21978:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return k}});var n=a(45008),s=a(57437),r=a(2265),l=a(13590),i=a(29501),o=a(62489),d=a(62869),c=a(88642),u=a(95186),f=a(73656),m=a(26564);a(83814);var p=a(2559),x=a(75500),h=a(88972),g=a(77992);let j=(0,a(38355).QS)(null);var v=a(57021),N=a(22574),y=a(16831),w=a(26110),b=a(50921);function S(){let e=(0,n._)(["\n    mutation UploadAvatar($file: Upload!) {\n      uploadAvatar(file: $file) {\n        name\n        image\n        team {\n          name\n          description\n          slug\n          avatar\n        }\n      }\n    }\n  "]);return S=function(){return e},e}function A(){var e;let[t,a]=(0,r.useState)(void 0),[n,l]=(0,r.useState)(void 0),[i,o]=(0,r.useState)(),[c,u]=(0,r.useState)(),f=(0,r.useRef)(null),m=(0,r.useRef)(null),g=(0,v.l)(j),[A,E]=(0,r.useState)(!1),{data:T}=(0,x.aM)(b.ME),_=(0,p.Ps)(S()),[k,{data:I}]=(0,h.D)(_),C=t||(null==T?void 0:null===(e=T.me.team)||void 0===e?void 0:e.avatar),O=(e,t,a)=>{let n=document.createElement("canvas"),s=e.naturalWidth/e.width,r=e.naturalHeight/e.height;return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(e,t.x*s,t.y*r,t.width*s,t.height*r,0,0,t.width,t.height),new Promise((e,t)=>{n.toBlob(a=>{if(!a){t(Error("Canvas is empty"));return}e(a)},"image/jpeg")})};async function R(){let e=await O(m.current,c,"avatar");a(URL.createObjectURL(e)),E(!1),k({variables:{file:new File([e],"avatar.jpg")}})}return(0,r.useEffect)(()=>{f.current&&(f.current.value="")},[A]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(y.Avatar,{className:"size-48 cursor-pointer",onClick:()=>{var e;return null===(e=f.current)||void 0===e?void 0:e.click()},children:[(0,s.jsx)(y.AvatarImage,{src:C||void 0,alt:"@"+(null==g?void 0:g.name)}),(0,s.jsx)(y.AvatarFallback,{className:"text-muted-foreground",children:"头像"})]}),(0,s.jsx)("input",{type:"file",ref:f,hidden:!0,onChange:function(e){var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){E(!0),o(void 0);let e=new FileReader;e.onload=()=>{var t;l(null===(t=e.result)||void 0===t?void 0:t.toString())},e.readAsDataURL(a)}}}),(0,s.jsx)(d.z,{onClick:()=>{var e;null===(e=f.current)||void 0===e||e.click()},className:"mt-5",children:"编辑头像"}),(0,s.jsx)(w.Vq,{open:A,onOpenChange:E,children:(0,s.jsxs)(w.cZ,{children:[(0,s.jsx)(w.fK,{children:(0,s.jsx)(w.$N,{children:"编辑头像"})}),(0,s.jsx)("div",{className:"flex items-center justify-center",children:(0,s.jsx)(N.ZP,{crop:i,onChange:(e,t)=>o(t),onComplete:e=>u(e),circularCrop:!0,aspect:1,keepSelection:!0,className:"w-full",children:(0,s.jsx)("img",{alt:"Crop preview",ref:m,src:n,onLoad:function(e){let{width:t,height:a}=e.currentTarget;o((0,N._H)((0,N.YG)({unit:"%",width:90},1,t,a),t,a))},className:"w-full"})})}),(0,s.jsx)(w.cN,{children:(0,s.jsx)(d.z,{type:"submit",className:"w-full",onClick:R,children:"保存头像"})})]})})]})}function E(){let e=(0,n._)(["\n  mutation UpdateProfile($input: UpdateProfileInput!) {\n    updateProfile(input: $input) {\n      slug\n      name\n      description\n      avatar\n    }\n  }\n"]);return E=function(){return e},e}let T=o.Ry({name:o.Z_().min(2).max(20),description:o.Z_()}),_=(0,p.Ps)(E());function k(){let{client:e,data:t}=(0,x.aM)(b.ME),[a]=(0,h.D)(_),{toast:n}=(0,g.pm)(),o=(0,i.cI)({resolver:(0,l.F)(T),defaultValues:{name:"",description:""}});return(0,r.useEffect)(()=>{t&&o.reset({name:t.me.team.name||"",description:t.me.team.description||""})},[o,t]),(0,s.jsxs)(c.l0,{...o,children:[(0,s.jsx)(m.r,{children:(0,s.jsx)(f.x,{heading:"个人资料",text:""})}),(0,s.jsxs)("div",{className:"my-5 flex",children:[(0,s.jsxs)("form",{onSubmit:o.handleSubmit(function(e){a({variables:{input:e}}).then(()=>{n({title:"更新成功",description:"个人资料已更新"})})}),className:"flex flex-1 flex-col gap-5 px-2",children:[(0,s.jsx)(c.Wi,{control:o.control,name:"name",render:e=>{let{field:t}=e;return(0,s.jsxs)(c.xJ,{children:[(0,s.jsx)(c.lX,{children:"显示名称"}),(0,s.jsx)(c.NI,{children:(0,s.jsx)(u.I,{placeholder:"文章作者栏",...t})}),(0,s.jsx)(c.pf,{children:"在文章作者栏展示"}),(0,s.jsx)(c.zG,{})]})}}),(0,s.jsx)(c.Wi,{control:o.control,name:"description",render:e=>{let{field:t}=e;return(0,s.jsxs)(c.xJ,{children:[(0,s.jsx)(c.lX,{children:"描述"}),(0,s.jsx)(c.NI,{children:(0,s.jsx)(u.I,{placeholder:"专栏页面展示",...t})}),(0,s.jsx)(c.zG,{})]})}}),(0,s.jsx)("div",{className:"flex",children:(0,s.jsx)(d.z,{type:"submit",children:"更新资料"})})]}),(0,s.jsx)("div",{className:"pl-10 text-center",children:(0,s.jsx)(A,{})})]})]})}},73656:function(e,t,a){"use strict";a.d(t,{x:function(){return s}});var n=a(57437);function s(e){let{heading:t,text:a,children:s}=e;return(0,n.jsxs)("div",{className:"flex items-center justify-between px-2",children:[(0,n.jsxs)("div",{className:"grid gap-1",children:[(0,n.jsx)("h1",{className:"font-heading text-3xl md:text-4xl",children:t}),a&&(0,n.jsx)("p",{className:"text-lg text-muted-foreground",children:a})]}),s]})}},26564:function(e,t,a){"use strict";a.d(t,{r:function(){return r}});var n=a(57437);a(2265);var s=a(94508);function r(e){let{children:t,className:a,...r}=e;return(0,n.jsx)("div",{className:(0,s.cn)("grid items-start gap-8",a),...r,children:t})}},16831:function(e,t,a){"use strict";a.d(t,{Avatar:function(){return i},AvatarFallback:function(){return d},AvatarImage:function(){return o}});var n=a(57437),s=a(2265),r=a(61146),l=a(94508);let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(r.fC,{ref:t,className:(0,l.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...s})});i.displayName=r.fC.displayName;let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(r.Ee,{ref:t,className:(0,l.cn)("aspect-square h-full w-full",a),...s})});o.displayName=r.Ee.displayName;let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(r.NY,{ref:t,className:(0,l.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...s})});d.displayName=r.NY.displayName},26110:function(e,t,a){"use strict";a.d(t,{$N:function(){return h},Be:function(){return g},Vq:function(){return o},cN:function(){return x},cQ:function(){return m},cZ:function(){return f},fK:function(){return p},hg:function(){return d}});var n=a(57437),s=a(2265),r=a(49027),l=a(32489),i=a(94508);let o=r.fC,d=r.xz,c=r.h_;r.x8;let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(r.aV,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});u.displayName=r.aV.displayName;let f=s.forwardRef((e,t)=>{let{className:a,children:s,close:o=!1,...d}=e;return(0,n.jsxs)(c,{children:[(0,n.jsx)(u,{}),(0,n.jsxs)(r.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...d,children:[s,o&&(0,n.jsxs)(r.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,n.jsx)(l.Z,{className:"size-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=r.VY.displayName;let m=s.forwardRef((e,t)=>{let{className:a,children:s,close:o=!1,...d}=e;return(0,n.jsx)(c,{children:(0,n.jsx)(u,{className:"DialogOverlay",children:(0,n.jsxs)(r.VY,{ref:t,className:(0,i.cn)("z-50 grid w-full max-w-lg gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...d,children:[s,o&&(0,n.jsxs)(r.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,n.jsx)(l.Z,{className:"size-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})})})});m.displayName=r.VY.displayName;let p=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};p.displayName="DialogHeader";let x=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};x.displayName="DialogFooter";let h=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(r.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});h.displayName=r.Dx.displayName;let g=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(r.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...s})});g.displayName=r.dk.displayName},77992:function(e,t,a){"use strict";a.d(t,{pm:function(){return f}});var n=a(2265);let s=0,r=new Map,l=e=>{if(r.has(e))return;let t=setTimeout(()=>{r.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);r.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?l(a):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],d={toasts:[]};function c(e){d=i(d,e),o.forEach(e=>{e(d)})}function u(e){let{...t}=e,a=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||n()}}}),{id:a,dismiss:n,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function f(){let[e,t]=n.useState(d);return n.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}}},function(e){e.O(0,[5558,6137,9485,2995,9064,8341,44,5306,1274,2759,2357,2971,2117,1744],function(){return e(e.s=93563)}),_N_E=e.O()}]);